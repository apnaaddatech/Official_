<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APNA ADDA</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700;900&display=swap" rel="stylesheet">

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        :root {
            --primary-red: #E50914; 
            --dark-black: #000000;
            --dark-gray: #141414;
            --light-text: #ffffff;
            --bottom-nav-height: 65px;
        }

        body {
            background-color: var(--dark-black);
            color: var(--light-text);
            font-family: 'Montserrat', sans-serif;
            overflow-x: hidden;
            padding-bottom: var(--bottom-nav-height); 
        }

        @media(min-width: 768px) {
            body { padding-bottom: 0; }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeIn 0.6s ease-out forwards; }

        /* Navigation Links (Desktop) */
        .nav-link {
            cursor: pointer;
            padding: 0.5rem 1rem;
            transition: color 0.3s ease;
            color: #aaa;
            font-weight: 500;
            font-size: 0.9rem;
            display: inline-block;
        }
        .nav-link:hover, .nav-link.active {
            color: var(--primary-red);
            font-weight: 700;
        }

        /* Mobile Bottom Nav Items */
        .mobile-nav-item {
            color: #666;
            transition: all 0.3s ease;
        }
        .mobile-nav-item.active {
            color: var(--primary-red);
        }
        .mobile-nav-item.active i {
            transform: translateY(-2px);
        }

        /* App Card Hover */
        .app-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background-color: var(--dark-gray);
            border: 1px solid #222;
        }
        .app-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-red);
            box-shadow: 0 5px 20px rgba(229, 9, 20, 0.3);
        }

        /* Slideshow Styles */
        .slide-image {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; opacity: 0; transition: opacity 1s ease-in-out; z-index: 0;
        }
        .slide-image.active { opacity: 1; }
        .hero-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.8) 100%); z-index: 1;
        }

        /* Utility */
        .hidden-section { display: none !important; }
        .hidden { display: none !important; }
        
        /* Inputs */
        input, select, textarea {
            background-color: #222; border: 1px solid #444; color: white;
        }
        input:focus, select:focus, textarea:focus {
            outline: none; border-color: var(--primary-red);
        }

        /* --- CHAT WIDGET STYLES --- */
        .support-btn {
            position: fixed;
            right: 20px;
            bottom: 30px; 
            background-color: var(--primary-red);
            color: white;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(229, 9, 20, 0.5);
            cursor: pointer;
            z-index: 9999;
            transition: transform 0.2s, bottom 0.3s;
        }
        .support-btn:hover { transform: scale(1.1); }
        .support-btn i { font-size: 1.5rem; }

        @media(max-width: 768px) {
            .support-btn {
                bottom: 85px; 
            }
        }

        .chat-box {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 350px;
            height: 450px;
            background-color: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.8);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform-origin: bottom right;
            transition: all 0.3s ease;
        }
        @media(max-width: 400px) {
            .chat-box { width: 90%; right: 5%; bottom: 150px; }
        }

        .chat-header {
            background-color: var(--primary-red); padding: 15px; font-weight: bold;
            display: flex; justify-content: space-between; align-items: center;
        }
        .chat-body {
            flex-grow: 1; padding: 15px; overflow-y: auto; background-color: #0f0f0f;
            display: flex; flex-direction: column; gap: 10px;
        }
        .chat-input-area {
            padding: 10px; background-color: #1a1a1a; border-top: 1px solid #333; display: flex; gap: 10px;
        }
        
        .msg-bubble { max-width: 80%; padding: 8px 12px; border-radius: 12px; font-size: 0.85rem; line-height: 1.4; word-wrap: break-word; }
        .msg-user { align-self: flex-end; background-color: var(--primary-red); color: white; border-bottom-right-radius: 2px; }
        .msg-system, .msg-admin { align-self: flex-start; background-color: #333; color: #ddd; border-bottom-left-radius: 2px; }
        .msg-system { border: 1px solid #444; font-style: italic; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- TOP NAVIGATION (DESKTOP ONLY) -->
    <nav class="w-full bg-black/95 backdrop-blur-sm border-b border-gray-900 sticky top-0 z-50 hidden md:block">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            
            <!-- LOGO -->
            <div class="text-2xl font-black tracking-widest text-red-600 cursor-pointer" onclick="navigateTo('home')">
                APNA ADDA
            </div>

            <!-- DESKTOP LINKS -->
            <div class="flex items-center gap-1">
                <span class="nav-link active" id="link-home" onclick="navigateTo('home')">Home</span>
                <span class="nav-link" id="link-apps" onclick="navigateTo('apps')">Our Apps</span>
                <span class="nav-link" id="link-about" onclick="navigateTo('about')">About Us</span>
                <span class="nav-link" id="link-contact" onclick="navigateTo('contact')">Contact Us</span>
                
                <div class="h-4 w-px bg-gray-700 mx-2"></div>

                <!-- Auth Buttons -->
                <button id="navLoginBtn" onclick="navigateTo('login')" class="text-white bg-red-600 hover:bg-red-700 px-4 py-1.5 rounded text-sm font-bold transition ml-2">Login</button>
                <button id="navDashboardBtn" onclick="navigateTo('admin')" class="hidden text-white bg-gray-800 hover:bg-gray-700 px-4 py-1.5 rounded text-sm transition ml-2">Dashboard</button>
                <button id="navLogoutBtn" onclick="handleLogout()" class="hidden text-red-500 hover:text-white px-3 py-1.5 text-sm transition font-bold ml-2">Logout</button>
            </div>
        </div>
    </nav>

    <!-- MOBILE TOP BAR (LOGO ONLY) -->
    <div class="md:hidden w-full bg-black border-b border-gray-900 sticky top-0 z-50 p-4 flex justify-between items-center">
        <div class="text-xl font-black tracking-widest text-red-600" onclick="navigateTo('home')">APNA ADDA</div>
        <!-- Auth State Indicator (Small Icon) -->
        <div id="mobileAuthIcon" onclick="navigateTo('login')" class="text-gray-400">
            <i class="fas fa-user-circle text-2xl"></i>
        </div>
    </div>

    <!-- MAIN CONTENT AREA -->
    <main class="flex-grow container mx-auto px-4 py-6 md:py-8">

        <!-- 1. HOME SECTION -->
        <div id="section-home" class="animate-fade-in">
            <div class="relative w-full rounded-2xl overflow-hidden mb-8 border border-gray-800 h-[50vh] md:h-auto">
                <div id="heroSlideshow" class="absolute inset-0 w-full h-full bg-gray-900"></div>
                <div class="hero-overlay"></div>
                <div class="relative z-10 flex flex-col items-center justify-center h-full py-20 md:py-32 text-center px-4">
                    <h1 class="text-4xl md:text-6xl lg:text-8xl font-black mb-4 md:mb-6 text-white tracking-tighter drop-shadow-2xl">
                        APNA <span class="text-red-600">ADDA</span>
                    </h1>
                    <p class="text-lg md:text-xl lg:text-2xl text-gray-200 font-light tracking-wide max-w-2xl mx-auto mb-8 md:mb-10 drop-shadow-md">
                        Technology for Everyday Growth.
                    </p>
                    <button onclick="scrollToHomeApps()" class="px-6 py-3 md:px-8 md:py-4 bg-red-600/20 backdrop-blur-md border-2 border-red-600 text-white font-bold rounded-full hover:bg-red-600 transition transform hover:scale-105 shadow-lg text-sm md:text-base">
                        EXPLORE APPS
                    </button>
                </div>
            </div>

            <div id="homeAppsContainer" class="py-8 md:py-10 border-t border-gray-900">
                <div class="text-center mb-8 md:mb-10">
                    <h2 class="text-2xl md:text-3xl font-bold border-b-4 border-red-600 inline-block pb-2">Latest Applications</h2>
                </div>
                <div id="homeLoader" class="text-center py-10">
                    <i class="fas fa-circle-notch fa-spin text-red-600 text-4xl"></i>
                    <p class="mt-2 text-gray-500">Loading...</p>
                </div>
                <div id="homeAppsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8"></div>
            </div>
        </div>

        <!-- 2. APPS SECTION -->
        <div id="section-apps" class="hidden-section animate-fade-in">
            <div class="text-center mb-8 md:mb-10">
                <h2 class="text-2xl md:text-3xl font-bold border-b-4 border-red-600 inline-block pb-2">All Applications</h2>
            </div>
            <div id="appsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8"></div>
        </div>

        <!-- 3. ABOUT US SECTION -->
        <div id="section-about" class="hidden-section animate-fade-in">
            <div class="max-w-4xl mx-auto bg-gray-900 border border-gray-800 rounded-lg p-6 md:p-12 shadow-2xl">
                <h2 class="text-2xl md:text-3xl font-bold mb-6 text-red-600">About APNA ADDA</h2>
                <div class="space-y-4 text-gray-300 leading-relaxed text-justify text-sm md:text-base">
                    <p>APNA ADDA is a technology-driven company committed to building smart, simple, and useful digital solutions for everyday life. We primarily focus on creating applications that support students, while also offering tools that benefit people from all walks of life.</p>
                    <p>Our apps are designed to make daily tasks easier, improve productivity, and provide practical solutions through modern technology. The company was founded and is owned by <strong>Premanshu Kumar</strong>.</p>
                </div>
                
                <!-- SOCIAL & CONTACT BUTTONS IN ABOUT -->
                <div class="mt-10 pt-6 border-t border-gray-700 flex flex-col gap-4">
                    <h3 class="text-center text-white font-bold mb-2">Connect With Us</h3>
                    <div class="flex flex-col md:flex-row flex-wrap justify-center gap-4">
                        <a href="mailto:thepremanshu@gmail.com" class="flex items-center justify-center gap-2 text-white bg-gray-800 hover:bg-gray-700 transition py-3 px-6 rounded font-bold shadow-lg">
                            <i class="fas fa-envelope text-red-500 text-xl"></i><span>Email Us</span>
                        </a>
                        <!-- Telegram Button -->
                        <a href="https://t.me/apnaadda_official" target="_blank" class="flex items-center justify-center gap-2 text-white bg-[#0088cc] hover:bg-[#0077b5] transition py-3 px-6 rounded font-bold shadow-lg">
                            <i class="fab fa-telegram-plane text-xl"></i><span>Telegram Channel</span>
                        </a>
                        <!-- WhatsApp Button -->
                        <a href="https://whatsapp.com/channel/0029Vb7K9Ms3gvWeXnfpLy3x" target="_blank" class="flex items-center justify-center gap-2 text-white bg-[#25D366] hover:bg-[#20bd5a] transition py-3 px-6 rounded font-bold shadow-lg">
                            <i class="fab fa-whatsapp text-xl"></i><span>WhatsApp Channel</span>
                        </a>
                    </div>
                </div>

                <!-- MOBILE SPECIFIC LEGAL LINKS -->
                <div class="md:hidden mt-8 pt-6 border-t border-gray-800">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">Legal Information</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div onclick="navigateTo('privacy')" class="bg-black p-3 rounded text-center border border-gray-800 cursor-pointer active:border-red-600">
                            <i class="fas fa-shield-alt text-red-600 mb-2 block text-xl"></i>
                            <span class="text-xs text-gray-400">Privacy Policy</span>
                        </div>
                        <div onclick="navigateTo('disclaimer')" class="bg-black p-3 rounded text-center border border-gray-800 cursor-pointer active:border-red-600">
                            <i class="fas fa-exclamation-circle text-red-600 mb-2 block text-xl"></i>
                            <span class="text-xs text-gray-400">Disclaimer</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. CONTACT US SECTION -->
        <div id="section-contact" class="hidden-section animate-fade-in">
            <div class="flex flex-col items-center justify-center min-h-[50vh]">
                <h2 class="text-3xl md:text-4xl font-bold mb-8">Get In Touch</h2>
                <div class="bg-gray-900 p-6 md:p-8 rounded-xl border border-gray-800 shadow-lg w-full max-w-lg text-center">
                    <p class="text-gray-400 mb-8 text-sm md:text-base">Have questions? Join our community or email us directly.</p>
                    
                    <div class="space-y-4">
                        <a href="mailto:thepremanshu@gmail.com" class="block w-full bg-white hover:bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded shadow transition flex items-center justify-center gap-3">
                            <i class="fab fa-google text-red-600 text-xl"></i> Send Email
                        </a>

                        <a href="https://t.me/apnaadda_official" target="_blank" class="block w-full bg-[#0088cc] hover:bg-[#0077b5] text-white font-bold py-3 px-6 rounded shadow transition flex items-center justify-center gap-3">
                            <i class="fab fa-telegram-plane text-xl"></i> Join Telegram
                        </a>

                        <a href="https://whatsapp.com/channel/0029Vb7K9Ms3gvWeXnfpLy3x" target="_blank" class="block w-full bg-[#25D366] hover:bg-[#20bd5a] text-white font-bold py-3 px-6 rounded shadow transition flex items-center justify-center gap-3">
                            <i class="fab fa-whatsapp text-xl"></i> Join WhatsApp
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- 5. PRIVACY POLICY -->
        <div id="section-privacy" class="hidden-section animate-fade-in">
            <div class="max-w-4xl mx-auto bg-gray-900 border border-gray-800 rounded-lg p-6 md:p-12 shadow-2xl">
                <h2 class="text-2xl font-bold mb-4 text-red-600">Privacy Policy</h2>
                <p class="text-gray-400 text-sm">Effective Date: 07 DECEMBER 2025</p>
                <div class="mt-4 text-gray-300 text-sm space-y-4">
                    <p>APNA ADDA respects your privacy. We collect minimal personal information (Name, Email) only for user authentication and support services.</p>
                    <p>We do not sell your data. Usage data is collected to improve app performance.</p>
                </div>
            </div>
        </div>

        <!-- 6. DISCLAIMER -->
        <div id="section-disclaimer" class="hidden-section animate-fade-in">
            <div class="max-w-4xl mx-auto bg-gray-900 border border-gray-800 rounded-lg p-6 md:p-12 shadow-2xl">
                <h2 class="text-2xl font-bold mb-4 text-red-600">Disclaimer</h2>
                <p class="text-gray-300 text-sm">The information provided on APNA ADDA is for general informational purposes only. We strive for accuracy but make no warranties about the completeness or reliability of the information.</p>
            </div>
        </div>

        <!-- 7. LOGIN / SIGNUP -->
        <div id="section-login" class="hidden-section flex justify-center items-center h-full py-10">
            <div class="bg-gray-900 p-8 rounded-lg border border-red-900/30 shadow-2xl w-full max-w-md animate-fade-in mx-2">
                <h2 class="text-2xl md:text-3xl font-bold text-center mb-2 text-white">Welcome</h2>
                <div class="flex justify-center gap-8 mb-6 border-b border-gray-800 pb-2">
                    <div id="tabLogin" class="cursor-pointer text-red-600 font-bold border-b-2 border-red-600 pb-1" onclick="toggleAuthMode('login')">Login</div>
                    <div id="tabSignup" class="cursor-pointer text-gray-500 pb-1" onclick="toggleAuthMode('signup')">Sign Up</div>
                </div>
                <form id="authForm" onsubmit="handleAuthSubmit(event)">
                    <div class="mb-4"><label class="block text-gray-400 mb-2 text-sm">Email</label><input type="email" id="authEmail" class="w-full p-3 rounded bg-black border-gray-700" required></div>
                    <div class="mb-6"><label class="block text-gray-400 mb-2 text-sm">Password</label><input type="password" id="authPassword" class="w-full p-3 rounded bg-black border-gray-700" required></div>
                    <button type="submit" id="authSubmitBtn" class="w-full bg-red-600 text-white font-bold py-3 rounded hover:bg-red-700 transition">LOGIN</button>
                </form>
            </div>
        </div>

        <!-- 8. ADMIN DASHBOARD -->
        <div id="section-admin" class="hidden-section">
            <div class="flex flex-col md:flex-row justify-between items-center mb-8 border-b border-gray-800 pb-4 gap-4">
                <h2 class="text-xl md:text-2xl font-bold text-white">Admin Dashboard</h2>
                <span class="bg-red-900/40 text-red-500 px-3 py-1 rounded text-xs border border-red-900">MASTER ACCESS</span>
            </div>
            <!-- APPS AND SLIDES GRID -->
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8 mb-12">
                <!-- Add App -->
                <div class="lg:col-span-1 bg-gray-900 p-6 rounded-lg border border-gray-800 h-fit">
                    <h3 class="text-lg font-bold text-white mb-4">Add / Edit App</h3>
                    <form id="appForm" onsubmit="handleAppSubmit(event)">
                        <input type="hidden" id="editAppId">
                        <div class="mb-3"><input type="text" id="appName" class="w-full p-2 rounded" placeholder="App Name" required></div>
                        <div class="mb-3">
                            <select id="launchStatus" class="w-full p-2 rounded" onchange="toggleStatusFields()" required>
                                <option value="Coming Soon">Coming Soon</option>
                                <option value="Coming in selected date">Specific Date</option>
                                <option value="Coming in selected weeks">Weeks</option>
                                <option value="Launched">Launched</option>
                            </select>
                        </div>
                        <div id="dateField" class="mb-3 hidden"><input type="date" id="statusDate" class="w-full p-2 rounded"></div>
                        <div id="weeksField" class="mb-3 hidden"><input type="number" id="statusWeeks" class="w-full p-2 rounded" placeholder="Weeks"></div>
                        <div class="mb-3"><input type="url" id="appLink" class="w-full p-2 rounded" placeholder="Link"></div>
                        <div class="mb-4"><input type="file" id="appImage" class="w-full text-xs text-gray-400" accept="image/*"></div>
                        <button type="submit" class="w-full bg-white text-black font-bold py-2 rounded">Save</button>
                    </form>
                </div>
                <!-- Support Centre (Simplified for display) -->
                <div class="lg:col-span-3 bg-gray-900 border border-gray-800 rounded-lg p-4">
                     <h3 class="text-lg font-bold text-white mb-4">Support Messages</h3>
                     <div id="adminSupportList" class="h-64 overflow-y-auto text-sm text-gray-400">Loading...</div>
                     <div id="adminChatBody" class="hidden"></div>
                     <div id="adminChatHeader" class="hidden"></div>
                     <input type="hidden" id="adminMsgInput">
                </div>
            </div>
        </div>

    </main>

    <!-- FOOTER (DESKTOP) -->
    <footer class="hidden md:block bg-black border-t border-gray-900 py-8 text-center mt-auto">
        <p class="text-gray-500 text-sm mb-1">&copy; 2025 APNA ADDA.</p>
        <p class="text-red-700 text-xs font-bold mb-4">Designed by Premanshu Kumar</p>
        <div class="flex flex-wrap justify-center gap-4 text-xs font-bold px-4">
            <span onclick="navigateTo('privacy')" class="cursor-pointer text-gray-400 hover:text-red-500">Privacy Policy</span>
            <span onclick="navigateTo('disclaimer')" class="cursor-pointer text-gray-400 hover:text-red-500">Disclaimer</span>
        </div>
    </footer>

    <!-- MOBILE BOTTOM NAVIGATION (FIXED) -->
    <div class="md:hidden fixed bottom-0 left-0 w-full bg-black/95 backdrop-blur-md border-t border-gray-800 z-50 flex justify-around items-center py-2 h-[65px]">
        <div onclick="navigateTo('home')" class="mobile-nav-item flex flex-col items-center justify-center w-full h-full cursor-pointer" id="mob-home">
            <i class="fas fa-home text-lg mb-1"></i>
            <span class="text-[10px] font-medium">Home</span>
        </div>
        <div onclick="navigateTo('apps')" class="mobile-nav-item flex flex-col items-center justify-center w-full h-full cursor-pointer" id="mob-apps">
            <i class="fas fa-th-large text-lg mb-1"></i>
            <span class="text-[10px] font-medium">Apps</span>
        </div>
        <div onclick="navigateTo('about')" class="mobile-nav-item flex flex-col items-center justify-center w-full h-full cursor-pointer" id="mob-about">
            <i class="fas fa-info-circle text-lg mb-1"></i>
            <span class="text-[10px] font-medium">About</span>
        </div>
        <div onclick="navigateTo('contact')" class="mobile-nav-item flex flex-col items-center justify-center w-full h-full cursor-pointer" id="mob-contact">
            <i class="fas fa-phone-alt text-lg mb-1"></i>
            <span class="text-[10px] font-medium">Contact</span>
        </div>
    </div>

    <!-- SUPPORT WIDGET -->
    <div id="userSupportWidget">
        <div class="support-btn" onclick="toggleUserChat()">
            <i class="fas fa-headset"></i>
        </div>
        <div id="userChatWindow" class="chat-box hidden transform scale-0 origin-bottom-right">
            <div class="chat-header">
                <span>APNA ADDA SUPPORT</span>
                <i class="fas fa-times cursor-pointer hover:text-black" onclick="toggleUserChat()"></i>
            </div>
            <div id="userChatBody" class="chat-body"></div>
            <div class="chat-input-area">
                <input type="text" id="userMsgInput" class="flex-grow bg-gray-900 border-gray-700 rounded-full px-4 text-sm" placeholder="Type a message..." onkeypress="if(event.key==='Enter') sendUserMessage()">
                <button onclick="sendUserMessage()" class="bg-red-600 hover:bg-red-700 text-white w-8 h-8 rounded-full flex items-center justify-center text-xs">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT -->
    <script>
        // FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyAUHUwmJVnW40FefXCpuxfREsnXNCHHxQU",
            authDomain: "ai-chatbot-51f32.firebaseapp.com",
            databaseURL: "https://ai-chatbot-51f32-default-rtdb.firebaseio.com",
            projectId: "ai-chatbot-51f32",
            storageBucket: "ai-chatbot-51f32.firebasestorage.app",
            messagingSenderId: "617183685078",
            appId: "1:617183685078:web:edcb7598cbaf82a7b8dc77"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);

        // STATE
        const ADMIN_EMAIL = "thepremanshu@gmail.com";
        const WHATSAPP_LINK = "https://whatsapp.com/channel/0029Vb7K9Ms3gvWeXnfpLy3x";
        const TELEGRAM_LINK = "https://t.me/apnaadda_official";

        let allApps = [], allSlides = [], currentUser = null, currentAdminChatUid = null, slideInterval = null;
        const sections = ['home', 'apps', 'about', 'contact', 'login', 'admin', 'privacy', 'disclaimer'];

        window.onload = function() {
            const savedSection = localStorage.getItem('apnaAddaCurrentSection') || 'home';
            if(savedSection !== 'admin') navigateTo(savedSection, true); 
            fetchApps(); fetchSlides();

            // --- FIRST TIME VISIT POPUP ---
            setTimeout(() => {
                const hasSeen = localStorage.getItem('hasSeenSocialPopup');
                const isAuthPage = document.getElementById('section-login').classList.contains('hidden-section') === false;
                
                if (!hasSeen && !isAuthPage) {
                    Swal.fire({
                        title: '<strong class="text-xl">STAY CONNECTED!</strong>',
                        html: `
                            <p class="text-gray-400 mb-6 text-sm">Join our official channels for the latest updates.</p>
                            <div class="flex flex-col gap-3">
                                <a href="${TELEGRAM_LINK}" target="_blank" class="w-full bg-[#0088cc] hover:bg-[#0077b5] text-white py-3 rounded font-bold flex items-center justify-center gap-2 transition">
                                    <i class="fab fa-telegram-plane text-xl"></i> Join Telegram
                                </a>
                                <a href="${WHATSAPP_LINK}" target="_blank" class="w-full bg-[#25D366] hover:bg-[#20bd5a] text-white py-3 rounded font-bold flex items-center justify-center gap-2 transition">
                                    <i class="fab fa-whatsapp text-xl"></i> Join WhatsApp
                                </a>
                            </div>
                        `,
                        background: '#141414',
                        showConfirmButton: false,
                        showCloseButton: true,
                        color: '#ffffff',
                        customClass: { popup: 'border border-gray-800 rounded-xl shadow-2xl' }
                    }).then(() => {
                        localStorage.setItem('hasSeenSocialPopup', 'true');
                    });
                }
            }, 1500);
        };

        function navigateTo(sectionId, isInitialLoad = false) {
            if(!isInitialLoad) localStorage.setItem('apnaAddaCurrentSection', sectionId);
            
            sections.forEach(s => {
                const el = document.getElementById(`section-${s}`);
                if(el) el.classList.add('hidden-section');
            });
            
            const target = document.getElementById(`section-${sectionId}`);
            if(target) target.classList.remove('hidden-section');
            
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            const dLink = document.getElementById(`link-${sectionId}`);
            if(dLink) dLink.classList.add('active');

            document.querySelectorAll('.mobile-nav-item').forEach(l => l.classList.remove('active'));
            const mLink = document.getElementById(`mob-${sectionId}`);
            if(mLink) mLink.classList.add('active');

            window.scrollTo(0, 0);
        }

        function scrollToHomeApps() {
            document.getElementById('homeAppsContainer').scrollIntoView({ behavior: 'smooth' });
        }

        // AUTH & SUPPORT
        auth.onAuthStateChanged((user) => {
            currentUser = user;
            const loginBtn = document.getElementById('navLoginBtn');
            const logoutBtn = document.getElementById('navLogoutBtn');
            const dashBtn = document.getElementById('navDashboardBtn');
            const mobAuthIcon = document.getElementById('mobileAuthIcon');
            
            if (user) {
                loginBtn.classList.add('hidden');
                logoutBtn.classList.remove('hidden');
                mobAuthIcon.innerHTML = `<i class="fas fa-sign-out-alt text-red-500 text-2xl" onclick="handleLogout(); event.stopPropagation();"></i>`;
                
                if (user.email === ADMIN_EMAIL) {
                    dashBtn.classList.remove('hidden');
                    initAdminSupport();
                } else {
                    dashBtn.classList.add('hidden');
                    initUserSupport(user.uid);
                }
            } else {
                loginBtn.classList.remove('hidden');
                logoutBtn.classList.add('hidden');
                dashBtn.classList.add('hidden');
                mobAuthIcon.innerHTML = `<i class="fas fa-user-circle text-2xl" onclick="navigateTo('login')"></i>`;
                document.getElementById('userChatWindow').classList.add('hidden');
            }
        });

        function handleLogout() {
            Swal.fire({
                title: 'Logout?', icon: 'warning', showCancelButton: true,
                confirmButtonColor: '#E50914', cancelButtonColor: '#333',
                background: '#111', color: '#fff'
            }).then((res) => {
                if(res.isConfirmed) {
                    localStorage.setItem('apnaAddaCurrentSection', 'home');
                    auth.signOut().then(() => navigateTo('home'));
                }
            });
        }

        function toggleAuthMode(mode) {
            const isSignup = (mode === 'signup');
            document.getElementById('authSubmitBtn').innerText = isSignup ? "SIGN UP" : "LOGIN";
            document.getElementById('tabLogin').className = isSignup ? "cursor-pointer text-gray-500 pb-1" : "cursor-pointer text-red-600 font-bold border-b-2 border-red-600 pb-1";
            document.getElementById('tabSignup').className = isSignup ? "cursor-pointer text-red-600 font-bold border-b-2 border-red-600 pb-1" : "cursor-pointer text-gray-500 pb-1";
            window.isSignupMode = isSignup;
        }

        function handleAuthSubmit(e) {
            e.preventDefault();
            const email = document.getElementById('authEmail').value;
            const pass = document.getElementById('authPassword').value;
            const action = window.isSignupMode ? auth.createUserWithEmailAndPassword(email, pass) : auth.signInWithEmailAndPassword(email, pass);
            
            action.then((cred) => {
                if(window.isSignupMode) db.ref('users/' + cred.user.uid).set({ email: email });
                Swal.fire({icon:'success', title: window.isSignupMode?'Signed Up':'Welcome', background:'#111', color:'#fff', timer:1500, showConfirmButton:false});
                navigateTo(cred.user.email === ADMIN_EMAIL ? 'admin' : 'home');
            }).catch(err => Swal.fire({icon:'error', text:err.message, background:'#111', color:'#fff'}));
        }

        // --- SUPPORT LOGIC ---
        function toggleUserChat() {
            if(!currentUser) {
                Swal.fire({icon:'info', title:'Authentication Required', text:'Please login to chat.', background:'#111', color:'#fff', confirmButtonColor:'#E50914'}).then(r=>{ if(r.isConfirmed) navigateTo('login'); });
                return;
            }
            const win = document.getElementById('userChatWindow');
            if(win.classList.contains('hidden')) {
                win.classList.remove('hidden'); setTimeout(()=>win.classList.remove('scale-0'),10);
            } else {
                win.classList.add('scale-0'); setTimeout(()=>win.classList.add('hidden'),300);
            }
        }

        function initUserSupport(uid) {
            const chatBody = document.getElementById('userChatBody');
            chatBody.innerHTML = `<div class="msg-bubble msg-system self-center text-center text-xs mb-4 text-gray-500">WELCOME TO THE APNA ADDA SUPPORT! <br> HOW CAN WE ASSIST YOU TODAY?</div>`;
            db.ref(`support/${uid}/messages`).on('child_added', (snapshot) => {
                const msg = snapshot.val();
                const div = document.createElement('div');
                div.className = `msg-bubble ${msg.sender === 'user' ? 'msg-user' : (msg.sender === 'system' ? 'msg-system' : 'msg-admin')}`;
                div.innerText = msg.text;
                chatBody.appendChild(div);
                chatBody.scrollTop = chatBody.scrollHeight;
            });
        }

        function sendUserMessage() {
            const text = document.getElementById('userMsgInput').value.trim();
            if(!text || !currentUser) return;
            const uid = currentUser.uid;
            const ref = db.ref(`support/${uid}`);
            
            ref.child('hasAutoReplied').once('value', (snap) => {
                ref.child('messages').push({ text, sender: 'user', timestamp: Date.now() });
                ref.child('userInfo').update({ email: currentUser.email, lastMsg: Date.now() });
                if (!snap.val()) {
                    setTimeout(() => {
                        ref.child('messages').push({ text: "OUR TEAM MEMBER WILL SHORTLY ASSISTS YOU!", sender: 'system', timestamp: Date.now() });
                        ref.child('hasAutoReplied').set(true);
                    }, 800);
                }
            });
            document.getElementById('userMsgInput').value = '';
        }

        function initAdminSupport() {
             db.ref('support').on('value', snap => {
                 const list = document.getElementById('adminSupportList');
                 list.innerHTML = '';
                 const data = snap.val();
                 if(!data) { list.innerHTML = 'No chats'; return; }
                 Object.keys(data).forEach(uid => {
                     const u = data[uid];
                     list.innerHTML += `<div class="p-2 border-b border-gray-700 cursor-pointer hover:bg-black" onclick="alert('Full admin chat UI implemented in previous version')">${u.userInfo?.email || 'User'}</div>`;
                 });
             });
        }

        function fetchApps() {
            db.ref('apps').on('value', (snap) => {
                const data = snap.val();
                allApps = [];
                if(data) Object.keys(data).forEach(k => allApps.push({id: k, ...data[k]}));
                renderPublicGrid();
            });
        }

        function renderPublicGrid() {
            const gridHome = document.getElementById('homeAppsGrid');
            const gridPage = document.getElementById('appsGrid');
            document.getElementById('homeLoader').style.display = 'none';
            gridHome.innerHTML = ''; gridPage.innerHTML = '';
            
            allApps.forEach(app => {
                let badge = app.status;
                let color = app.status === 'Launched' ? 'bg-green-600' : 'bg-gray-600';
                if(app.status.includes('date')) { badge = `Coming: ${app.statusDetail}`; color='bg-blue-600'; }
                
                const html = `
                    <div class="app-card rounded-lg overflow-hidden flex flex-col h-full relative">
                        <div class="relative"><img src="${app.image}" class="w-full aspect-video object-cover">
                        <span class="absolute top-2 right-2 ${color} text-white text-[10px] font-bold px-2 py-1 rounded">${badge}</span></div>
                        <div class="p-5 flex flex-col flex-grow bg-gray-900"><h3 class="text-xl font-bold mb-4 text-white">${app.name}</h3>
                        <a href="${app.link||'#'}" class="block w-full text-center ${app.status==='Launched'?'bg-red-600 text-white':'bg-gray-800 text-gray-500'} font-bold py-2 rounded text-sm">${app.status==='Launched'?'CLICK HERE':'Wait for Launch'}</a></div>
                    </div>`;
                gridHome.innerHTML += html; gridPage.innerHTML += html;
            });
        }

        function fetchSlides() {
            db.ref('slides').on('value', snap => {
                const data = snap.val();
                const container = document.getElementById('heroSlideshow');
                container.innerHTML = '';
                if(data) {
                    Object.values(data).forEach((s, i) => {
                        const img = document.createElement('img');
                        img.src = s.image;
                        img.className = `slide-image ${i===0?'active':''}`;
                        container.appendChild(img);
                    });
                    if(Object.keys(data).length > 1) {
                        let idx = 0;
                        const imgs = document.querySelectorAll('.slide-image');
                        setInterval(() => {
                            imgs[idx].classList.remove('active');
                            idx = (idx + 1) % imgs.length;
                            imgs[idx].classList.add('active');
                        }, 5000);
                    }
                }
            });
        }

        function toggleStatusFields() {
             const v = document.getElementById('launchStatus').value;
             document.getElementById('dateField').classList.toggle('hidden', !v.includes('date'));
             document.getElementById('weeksField').classList.toggle('hidden', !v.includes('weeks'));
        }
        async function handleAppSubmit(e) {
            e.preventDefault();
            const name = document.getElementById('appName').value;
            const status = document.getElementById('launchStatus').value;
            const file = document.getElementById('appImage').files[0];
            let img64 = null;
            if(file) img64 = await new Promise(r=>{const rd=new FileReader();rd.onload=()=>r(rd.result);rd.readAsDataURL(file)});
            db.ref('apps').push({name, status, image: img64});
            document.getElementById('appForm').reset();
            Swal.fire({icon:'success', title:'Saved', background:'#111', color:'#fff', timer:1000, showConfirmButton:false});
        }
    </script>
</body>
</html>
