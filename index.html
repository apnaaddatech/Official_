<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APNA ADDA</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700;900&display=swap" rel="stylesheet">

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        :root {
            --primary-red: #E50914; 
            --dark-black: #000000;
            --dark-gray: #141414;
            --light-text: #ffffff;
        }

        body {
            background-color: var(--dark-black);
            color: var(--light-text);
            font-family: 'Montserrat', sans-serif;
            overflow-x: hidden;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }

        /* Navigation Links */
        .nav-link {
            cursor: pointer;
            padding: 0.5rem 1rem;
            transition: color 0.3s ease;
            color: #aaa;
            font-weight: 500;
            font-size: 0.9rem;
        }
        .nav-link:hover, .nav-link.active {
            color: var(--primary-red);
            font-weight: 700;
        }

        /* App Card Hover */
        .app-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background-color: var(--dark-gray);
            border: 1px solid #222;
        }
        .app-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-red);
            box-shadow: 0 5px 20px rgba(229, 9, 20, 0.3);
        }

        /* Utility */
        .hidden-section {
            display: none !important;
        }
        
        /* Inputs */
        input, select, textarea {
            background-color: #222;
            border: 1px solid #444;
            color: white;
        }
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-red);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #111; }
        ::-webkit-scrollbar-thumb { background: #E50914; border-radius: 4px; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- NAVIGATION -->
    <nav class="w-full bg-black border-b border-gray-900 sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center">
            <!-- LOGO TEXT -->
            <div class="text-2xl font-black tracking-widest text-red-600 cursor-pointer mb-4 md:mb-0" onclick="navigateTo('home')">
                APNA ADDA
            </div>

            <!-- Links -->
            <div class="flex flex-wrap justify-center gap-2 items-center">
                <span class="nav-link active" id="link-home" onclick="navigateTo('home')">Home</span>
                <span class="nav-link" id="link-apps" onclick="navigateTo('apps')">Our Apps</span>
                <span class="nav-link" id="link-about" onclick="navigateTo('about')">About Us</span>
                <span class="nav-link" id="link-contact" onclick="navigateTo('contact')">Contact Us</span>
                
                <!-- Separator -->
                <div class="h-4 w-px bg-gray-700 mx-2"></div>

                <!-- Login / Dashboard / Logout -->
                <button id="navLoginBtn" onclick="navigateTo('login')" class="text-white bg-red-600 hover:bg-red-700 px-4 py-1.5 rounded text-sm font-bold transition">
                    Login
                </button>
                
                <button id="navDashboardBtn" onclick="navigateTo('admin')" class="hidden text-white bg-gray-800 hover:bg-gray-700 px-4 py-1.5 rounded text-sm transition">
                    Dashboard
                </button>
                
                <button id="navLogoutBtn" onclick="handleLogout()" class="hidden text-red-500 hover:text-white px-3 py-1.5 text-sm transition font-bold">
                    Logout
                </button>
            </div>
        </div>
    </nav>

    <!-- MAIN CONTENT AREA -->
    <main class="flex-grow container mx-auto px-4 py-8">

        <!-- 1. HOME SECTION -->
        <div id="section-home" class="animate-fade-in">
            <!-- Hero -->
            <div class="flex flex-col items-center justify-center py-32 text-center mb-8">
                <h1 class="text-6xl md:text-8xl font-black mb-6 text-white tracking-tighter">
                    APNA <span class="text-red-600">ADDA</span>
                </h1>
                <p class="text-xl md:text-2xl text-gray-400 font-light tracking-wide max-w-2xl mx-auto mb-10">
                    Technology for Everyday Growth.
                </p>
                <button onclick="scrollToHomeApps()" class="px-8 py-4 bg-transparent border-2 border-red-600 text-red-600 font-bold rounded-full hover:bg-red-600 hover:text-white transition transform hover:scale-105">
                    EXPLORE APPS
                </button>
            </div>

            <!-- Home Page Apps Grid -->
            <div id="homeAppsContainer" class="py-10 border-t border-gray-900">
                <div class="text-center mb-10">
                    <h2 class="text-3xl font-bold border-b-4 border-red-600 inline-block pb-2">Latest Applications</h2>
                </div>
                
                <div id="homeLoader" class="text-center py-10">
                    <i class="fas fa-circle-notch fa-spin text-red-600 text-4xl"></i>
                    <p class="mt-2 text-gray-500">Loading...</p>
                </div>

                <div id="homeAppsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Apps loaded via JS here too -->
                </div>
            </div>
        </div>

        <!-- 2. APPS SECTION (Dedicated Page) -->
        <div id="section-apps" class="hidden-section animate-fade-in">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-bold border-b-4 border-red-600 inline-block pb-2">All Applications</h2>
            </div>
            
            <div id="appsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Apps loaded via JS -->
            </div>
        </div>

        <!-- 3. ABOUT US SECTION -->
        <div id="section-about" class="hidden-section animate-fade-in">
            <div class="max-w-4xl mx-auto bg-gray-900 border border-gray-800 rounded-lg p-8 md:p-12 shadow-2xl">
                <h2 class="text-3xl font-bold mb-6 text-red-600">About APNA ADDA</h2>
                
                <div class="space-y-4 text-gray-300 leading-relaxed text-justify">
                    <p>
                        APNA ADDA is a technology-driven company committed to building smart, simple, and useful digital solutions for everyday life. We primarily focus on creating applications that support students, while also offering tools that benefit people from all walks of life.
                    </p>
                    <p>
                        Our apps are designed to make daily tasks easier, improve productivity, and provide practical solutions through modern technology. At APNA ADDA, we believe that technology should be accessible, reliable, and purpose-driven.
                    </p>
                    <p>
                        The company was founded and is owned by <strong>Premanshu Kumar</strong>, a passionate developer focused on creating meaningful digital products that solve real-world problems. This official website of APNA ADDA represents our mission, our products, and our commitment to quality and innovation.
                    </p>
                    <p>
                        We continuously work to improve our applications and introduce new ideas that can make a positive impact on education and daily living.
                    </p>
                    <p class="text-xl font-bold text-white mt-6 text-center">
                        APNA ADDA â€“ Technology for Everyday Growth.
                    </p>
                </div>

                <!-- Social Links in About -->
                <div class="mt-10 pt-6 border-t border-gray-700 flex justify-center gap-6">
                    <a href="mailto:thepremanshu@gmail.com" class="flex items-center gap-2 text-gray-400 hover:text-white transition">
                        <i class="fas fa-envelope text-red-500 text-xl"></i>
                        <span>Email Us</span>
                    </a>
                    <a href="https://t.me/apnaadda_official" target="_blank" class="flex items-center gap-2 text-gray-400 hover:text-blue-400 transition">
                        <i class="fab fa-telegram text-blue-500 text-xl"></i>
                        <span>Telegram Channel</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- 4. CONTACT US SECTION -->
        <div id="section-contact" class="hidden-section animate-fade-in">
            <div class="flex flex-col items-center justify-center min-h-[50vh]">
                <h2 class="text-4xl font-bold mb-8">Get In Touch</h2>
                
                <div class="bg-gray-900 p-8 rounded-xl border border-gray-800 shadow-lg w-full max-w-lg text-center">
                    <p class="text-gray-400 mb-8">
                        Have questions, suggestions, or just want to say hello? Reach out to us directly.
                    </p>

                    <div class="space-y-4">
                        <!-- Google Email Button -->
                        <a href="mailto:thepremanshu@gmail.com" class="block w-full bg-white hover:bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded shadow transition flex items-center justify-center gap-3">
                            <i class="fab fa-google text-red-600"></i>
                            Send Email
                        </a>

                        <!-- Telegram Button -->
                        <a href="https://t.me/apnaadda_official" target="_blank" class="block w-full bg-[#0088cc] hover:bg-[#0077b5] text-white font-bold py-3 px-6 rounded shadow transition flex items-center justify-center gap-3">
                            <i class="fab fa-telegram-plane"></i>
                            Join Telegram
                        </a>
                    </div>

                    <div class="mt-8 text-sm text-gray-600">
                        Response time: Within 24 hours
                    </div>
                </div>
            </div>
        </div>

        <!-- 5. LOGIN / SIGNUP SECTION -->
        <div id="section-login" class="hidden-section flex justify-center items-center h-full py-10">
            <div class="bg-gray-900 p-8 rounded-lg border border-red-900/30 shadow-2xl w-full max-w-md animate-fade-in">
                <h2 class="text-3xl font-bold text-center mb-2 text-white">Welcome</h2>
                <p class="text-center text-gray-500 mb-6 text-sm">Sign in to manage your world</p>

                <!-- Toggles -->
                <div class="flex justify-center gap-8 mb-6 border-b border-gray-800 pb-2">
                    <div id="tabLogin" class="cursor-pointer text-red-600 font-bold border-b-2 border-red-600 pb-1" onclick="toggleAuthMode('login')">Login</div>
                    <div id="tabSignup" class="cursor-pointer text-gray-500 pb-1" onclick="toggleAuthMode('signup')">Sign Up</div>
                </div>

                <form id="authForm" onsubmit="handleAuthSubmit(event)">
                    <div class="mb-4">
                        <label class="block text-gray-400 mb-2 text-sm">Email</label>
                        <input type="email" id="authEmail" class="w-full p-3 rounded bg-black border-gray-700 focus:border-red-600 transition" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-400 mb-2 text-sm">Password</label>
                        <input type="password" id="authPassword" class="w-full p-3 rounded bg-black border-gray-700 focus:border-red-600 transition" required>
                    </div>
                    <button type="submit" id="authSubmitBtn" class="w-full bg-red-600 text-white font-bold py-3 rounded hover:bg-red-700 transition">
                        LOGIN
                    </button>
                </form>
            </div>
        </div>

        <!-- 6. ADMIN DASHBOARD (Protected) -->
        <div id="section-admin" class="hidden-section">
            <div class="flex justify-between items-center mb-8 border-b border-gray-800 pb-4">
                <h2 class="text-2xl font-bold text-white">Admin Dashboard</h2>
                <span class="bg-red-900/40 text-red-500 px-3 py-1 rounded text-xs border border-red-900">MASTER ACCESS</span>
            </div>

            <!-- Dashboard Content Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Add Form -->
                <div class="lg:col-span-1 bg-gray-900 p-6 rounded-lg border border-gray-800 h-fit">
                    <h3 id="formTitle" class="text-lg font-bold text-white mb-4">Add / Edit App</h3>
                    <form id="appForm" onsubmit="handleAppSubmit(event)">
                        <input type="hidden" id="editAppId">
                        
                        <div class="mb-3"><label class="text-xs text-gray-400 block mb-1">Name</label><input type="text" id="appName" class="w-full p-2 rounded" required></div>
                        <div class="mb-3">
                            <label class="text-xs text-gray-400 block mb-1">Status</label>
                            <select id="launchStatus" class="w-full p-2 rounded" onchange="toggleStatusFields()" required>
                                <option value="Coming Soon">Coming Soon</option>
                                <option value="Coming in selected date">Specific Date</option>
                                <option value="Coming in selected weeks">Weeks</option>
                                <option value="Launched">Launched</option>
                            </select>
                        </div>
                        <div id="dateField" class="mb-3 hidden"><label class="text-xs text-gray-400 block mb-1">Date</label><input type="date" id="statusDate" class="w-full p-2 rounded"></div>
                        <div id="weeksField" class="mb-3 hidden"><label class="text-xs text-gray-400 block mb-1">Weeks</label><input type="number" id="statusWeeks" class="w-full p-2 rounded"></div>
                        <div class="mb-3"><label class="text-xs text-gray-400 block mb-1">Link</label><input type="url" id="appLink" class="w-full p-2 rounded"></div>
                        <div class="mb-4"><label class="text-xs text-gray-400 block mb-1">Image</label><input type="file" id="appImage" class="w-full text-xs text-gray-400" accept="image/*"></div>

                        <div class="flex gap-2">
                            <button type="submit" id="submitBtn" class="flex-1 bg-white text-black font-bold py-2 rounded hover:bg-gray-200">Save</button>
                            <button type="button" onclick="resetForm()" class="px-3 border border-gray-600 rounded text-white">Reset</button>
                        </div>
                    </form>
                </div>

                <!-- List -->
                <div class="lg:col-span-2 bg-gray-900 rounded-lg border border-gray-800 overflow-hidden">
                    <div class="p-4 bg-black border-b border-gray-800"><h3 class="font-bold">App Database</h3></div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm text-gray-400">
                            <thead class="bg-gray-800 text-xs uppercase"><tr><th class="p-3">Img</th><th class="p-3">Name</th><th class="p-3">Status</th><th class="p-3 text-right">Action</th></tr></thead>
                            <tbody id="adminAppsTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- FOOTER -->
    <footer class="bg-black border-t border-gray-900 py-6 text-center mt-auto">
        <p class="text-gray-500 text-sm">&copy; 2025 APNA ADDA. All Rights Reserved.</p>
        <p class="text-red-700 text-xs font-bold mt-1">Designed by Premanshu Kumar</p>
    </footer>

    <!-- JAVASCRIPT -->
    <script>
        // 1. FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyBuHyKMQ62V_1dSNP4fcmMIowVwhlJuIn8",
            authDomain: "apna-adda-company.firebaseapp.com",
            databaseURL: "https://apna-adda-company-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "apna-adda-company",
            storageBucket: "apna-adda-company.firebasestorage.app",
            messagingSenderId: "446756963502",
            appId: "1:446756963502:web:d286ce81aef97fe9ce193f"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        // Ensure persistence is set to LOCAL
        auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);

        // 2. STATE
        const ADMIN_EMAIL = "thepremanshu@gmail.com";
        let allApps = [];
        let isSignupMode = false;
        const sections = ['home', 'apps', 'about', 'contact', 'login', 'admin'];

        // 3. TELEGRAM POPUP & INIT
        window.onload = function() {
            // Restore last visited section from LocalStorage
            const savedSection = localStorage.getItem('apnaAddaCurrentSection') || 'home';
            
            // If the saved section is NOT admin, we can go there immediately.
            // If it IS admin, we wait for the auth observer to handle it to avoid flickering/kicking out.
            if(savedSection !== 'admin') {
                navigateTo(savedSection, true); 
            } else {
                // Show loading or just stay blank until auth decides
                // For smoother UX, we can default to home temporarily if needed, 
                // but let's let onAuthStateChanged handle the final routing.
            }

            setTimeout(() => {
                // Only show popup if not on admin page
                const current = localStorage.getItem('apnaAddaCurrentSection');
                if(current === 'admin') return;

                Swal.fire({
                    title: '<strong style="color:#fff">Join Telegram Channel</strong>',
                    html: '<span style="color:#bbb">Stay updated with latest apps & features!</span>',
                    icon: 'info',
                    background: '#141414',
                    showCancelButton: true,
                    confirmButtonColor: '#0088cc', // Telegram Blue
                    cancelButtonColor: '#333',
                    confirmButtonText: '<i class="fab fa-telegram-plane"></i> Join Now',
                    cancelButtonText: 'Maybe Later'
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.open('https://t.me/apnaadda_official', '_blank');
                    }
                });
            }, 1000); 
            
            // Initial Fetch
            fetchApps();
        };

        // 4. NAVIGATION LOGIC
        function navigateTo(sectionId, isInitialLoad = false) {
            // If not initial load, save the preference
            if(!isInitialLoad) {
                localStorage.setItem('apnaAddaCurrentSection', sectionId);
            }

            // UI updates
            sections.forEach(s => document.getElementById(`section-${s}`).classList.add('hidden-section'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));

            document.getElementById(`section-${sectionId}`).classList.remove('hidden-section');
            const navLink = document.getElementById(`link-${sectionId}`);
            if (navLink) navLink.classList.add('active');

            // Scroll to top
            window.scrollTo(0, 0);
        }

        function scrollToHomeApps() {
            document.getElementById('homeAppsContainer').scrollIntoView({ behavior: 'smooth' });
        }

        // 5. AUTH OBSERVER (The Fix)
        auth.onAuthStateChanged((user) => {
            const loginBtn = document.getElementById('navLoginBtn');
            const logoutBtn = document.getElementById('navLogoutBtn');
            const dashBtn = document.getElementById('navDashboardBtn');
            
            // 1. Update Buttons
            if (user) {
                loginBtn.classList.add('hidden');
                logoutBtn.classList.remove('hidden');
                if (user.email === ADMIN_EMAIL) {
                    dashBtn.classList.remove('hidden');
                } else {
                    dashBtn.classList.add('hidden');
                }
            } else {
                loginBtn.classList.remove('hidden');
                logoutBtn.classList.add('hidden');
                dashBtn.classList.add('hidden');
            }

            // 2. Handle Smart Redirection (Persistence Logic)
            const savedSection = localStorage.getItem('apnaAddaCurrentSection');
            
            if (user) {
                // User IS logged in
                if (savedSection === 'login') {
                    // If they were on login page, move them to Dashboard or Home
                    if(user.email === ADMIN_EMAIL) navigateTo('admin');
                    else navigateTo('home');
                } else if (savedSection === 'admin') {
                    // If they were on Admin, verify email
                    if(user.email === ADMIN_EMAIL) {
                        navigateTo('admin'); // Allow access
                    } else {
                        navigateTo('home'); // Kick out
                    }
                } 
                // If savedSection is home/apps/etc, they stay there automatically via window.onload logic
            } else {
                // User is NOT logged in
                if (savedSection === 'admin') {
                    // If they tried to access admin but aren't logged in, kick to login
                    navigateTo('login');
                }
            }
        });

        // 6. LOGIN/SIGNUP LOGIC
        function toggleAuthMode(mode) {
            isSignupMode = (mode === 'signup');
            const loginTab = document.getElementById('tabLogin');
            const signupTab = document.getElementById('tabSignup');
            const btn = document.getElementById('authSubmitBtn');

            if (isSignupMode) {
                loginTab.classList.replace('text-red-600', 'text-gray-500');
                loginTab.classList.remove('font-bold', 'border-b-2');
                signupTab.classList.replace('text-gray-500', 'text-red-600');
                signupTab.classList.add('font-bold', 'border-b-2', 'border-red-600');
                btn.innerText = "SIGN UP";
            } else {
                signupTab.classList.replace('text-red-600', 'text-gray-500');
                signupTab.classList.remove('font-bold', 'border-b-2');
                loginTab.classList.replace('text-gray-500', 'text-red-600');
                loginTab.classList.add('font-bold', 'border-b-2', 'border-red-600');
                btn.innerText = "LOGIN";
            }
        }

        function handleAuthSubmit(e) {
            e.preventDefault();
            const email = document.getElementById('authEmail').value;
            const pass = document.getElementById('authPassword').value;

            if (isSignupMode) {
                auth.createUserWithEmailAndPassword(email, pass)
                    .then(() => {
                        Swal.fire({icon:'success', title:'Signed Up!', background:'#111', color:'#fff', confirmButtonColor:'#E50914'});
                        navigateTo('home');
                    })
                    .catch(err => Swal.fire({icon:'error', title:'Error', text:err.message, background:'#111', color:'#fff'}));
            } else {
                auth.signInWithEmailAndPassword(email, pass)
                    .then((cred) => {
                        Swal.fire({icon:'success', title:'Welcome', timer:1500, showConfirmButton:false, background:'#111', color:'#fff'});
                        if(cred.user.email === ADMIN_EMAIL) navigateTo('admin');
                        else navigateTo('home');
                    })
                    .catch(err => Swal.fire({icon:'error', title:'Error', text:err.message, background:'#111', color:'#fff'}));
            }
        }

        function handleLogout() {
            Swal.fire({
                title: 'Logout?', icon: 'warning', showCancelButton: true,
                confirmButtonColor: '#E50914', cancelButtonColor: '#333',
                background: '#111', color: '#fff'
            }).then((res) => {
                if(res.isConfirmed) {
                    localStorage.setItem('apnaAddaCurrentSection', 'home'); // Reset Nav
                    auth.signOut().then(() => navigateTo('home'));
                }
            });
        }

        // 7. DATA LOGIC
        function fetchApps() {
            db.ref('apps').on('value', (snap) => {
                const data = snap.val();
                allApps = [];
                if(data) Object.keys(data).forEach(k => allApps.push({id: k, ...data[k]}));
                renderPublicGrid();
                renderAdminTable();
            });
        }

        function renderPublicGrid() {
            const gridHome = document.getElementById('homeAppsGrid');
            const gridPage = document.getElementById('appsGrid');
            const loader = document.getElementById('homeLoader');
            
            if(loader) loader.style.display = 'none';
            gridHome.innerHTML = '';
            gridPage.innerHTML = '';

            if(allApps.length === 0) {
                const empty = '<div class="col-span-3 text-center text-gray-500">No apps available yet.</div>';
                gridHome.innerHTML = empty;
                gridPage.innerHTML = empty;
                return;
            }

            allApps.forEach(app => {
                let img = app.image ? `<img src="${app.image}" class="w-full aspect-video object-cover">` : `<div class="w-full aspect-video bg-gray-800 flex items-center justify-center text-red-600 font-bold">APNA ADDA</div>`;
                
                let badge = app.status;
                let color = 'bg-gray-600';
                let btnTxt = 'Wait for Launch';
                let btnClass = 'bg-gray-800 text-gray-500 cursor-not-allowed';
                let link = '#';

                if(app.status === 'Launched') {
                    color = 'bg-green-600';
                    btnTxt = 'CLICK HERE';
                    btnClass = 'bg-red-600 hover:bg-red-700 text-white';
                    link = app.link || '#';
                } else if(app.status.includes('date')) {
                    badge = `Coming: ${app.statusDetail}`;
                    color = 'bg-blue-600';
                } else if(app.status.includes('weeks')) {
                    badge = `In ${app.statusDetail} Weeks`;
                    color = 'bg-purple-600';
                }

                const cardHtml = `
                    <div class="app-card rounded-lg overflow-hidden flex flex-col h-full relative">
                        <div class="relative">${img}<span class="absolute top-2 right-2 ${color} text-white text-[10px] font-bold px-2 py-1 rounded shadow">${badge}</span></div>
                        <div class="p-5 flex flex-col flex-grow bg-gray-900">
                            <h3 class="text-xl font-bold mb-4 text-white">${app.name}</h3>
                            <div class="mt-auto">
                                <a href="${link}" ${app.status==='Launched'?'target="_blank"':''} class="block w-full text-center ${btnClass} font-bold py-2 rounded transition text-sm">${btnTxt}</a>
                            </div>
                        </div>
                    </div>`;
                
                gridHome.innerHTML += cardHtml;
                gridPage.innerHTML += cardHtml;
            });
        }

        function renderAdminTable() {
            const tb = document.getElementById('adminAppsTable');
            tb.innerHTML = '';
            allApps.forEach(app => {
                tb.innerHTML += `
                    <tr class="border-b border-gray-800">
                        <td class="p-3">${app.image ? '<span class="text-green-500">Img</span>' : '<span class="text-red-500">No</span>'}</td>
                        <td class="p-3 text-white">${app.name}</td>
                        <td class="p-3 text-xs text-gray-400">${app.status}</td>
                        <td class="p-3 text-right">
                            <button onclick="editApp('${app.id}')" class="text-blue-400 mr-2"><i class="fas fa-edit"></i></button>
                            <button onclick="deleteApp('${app.id}')" class="text-red-500"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>`;
            });
        }

        // 8. ADMIN ACTIONS
        function toggleStatusFields() {
            const s = document.getElementById('launchStatus').value;
            document.getElementById('dateField').classList.add('hidden');
            document.getElementById('weeksField').classList.add('hidden');
            if(s.includes('date')) document.getElementById('dateField').classList.remove('hidden');
            if(s.includes('weeks')) document.getElementById('weeksField').classList.remove('hidden');
        }

        async function handleAppSubmit(e) {
            e.preventDefault();
            const id = document.getElementById('editAppId').value;
            const name = document.getElementById('appName').value;
            const status = document.getElementById('launchStatus').value;
            const link = document.getElementById('appLink').value;
            let detail = '';
            if(status.includes('date')) detail = document.getElementById('statusDate').value;
            if(status.includes('weeks')) detail = document.getElementById('statusWeeks').value;

            if(!(await Swal.fire({title:'Save Changes?', icon:'question', showCancelButton:true, background:'#111', color:'#fff'})).isConfirmed) return;

            const file = document.getElementById('appImage').files[0];
            let img64 = null;
            if(file) {
                img64 = await new Promise(r => {const rd=new FileReader(); rd.onload=()=>r(rd.result); rd.readAsDataURL(file);});
            } else if(id) {
                const old = allApps.find(a=>a.id===id);
                if(old) img64 = old.image;
            }

            const payload = {name, status, statusDetail:detail, link, image:img64||''};
            if(id) db.ref('apps/'+id).update(payload);
            else db.ref('apps').push(payload);
            
            resetForm();
            Swal.fire({icon:'success', title:'Saved', background:'#111', color:'#fff', timer:1500, showConfirmButton:false});
        }

        function editApp(id) {
            const app = allApps.find(a=>a.id===id);
            if(!app) return;
            document.getElementById('editAppId').value = app.id;
            document.getElementById('appName').value = app.name;
            document.getElementById('launchStatus').value = app.status;
            document.getElementById('appLink').value = app.link || '';
            toggleStatusFields();
            if(app.status.includes('date')) document.getElementById('statusDate').value = app.statusDetail;
            if(app.status.includes('weeks')) document.getElementById('statusWeeks').value = app.statusDetail;
        }

        function deleteApp(id) {
            Swal.fire({title:'Delete?', icon:'warning', showCancelButton:true, background:'#111', color:'#fff'}).then(r => {
                if(r.isConfirmed) db.ref('apps/'+id).remove();
            });
        }

        function resetForm() {
            document.getElementById('appForm').reset();
            document.getElementById('editAppId').value = '';
            toggleStatusFields();
        }
    </script>
</body>
</html>